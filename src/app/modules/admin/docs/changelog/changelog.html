<div class="flex flex-col flex-auto min-w-0">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
        <div class="flex-1 min-w-0">
            <!-- Title -->
            <div class="mt-2">
                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
                    PIN SENDER
                </h2>
            </div>
        </div>
    </div>

    <div class="flex-auto p-6 sm:p-10">
        <div class="prose prose-sm max-w-5xl">
            <ng-container>
                <div class="mb-12 p-8 rounded-2xl shadow bg-skyblue"> <!-- Background color applied here -->
                    <div class="flex flex-col sm:flex-row items-start justify-start min-h-screen p-4 sm:p-10 gap-12">
                        <!-- Description Section -->
                        <div class="prose prose-sm w-full sm:w-1/3 sm:mr-16 sm:order-2">
                            <h2 class="mt-20">Envoi de code PIN Card</h2>
                            <p>
                                Le processus de vérification des informations du titulaire de la carte et l'envoi d'un code PIN par SMS. Voici les étapes impliquées :
                            </p>
                            <ol>
                                <li>Saisissez le numéro de carte, le CIN et le numéro de téléphone.</li>
                                <li>Cliquez sur "Envoyer OTP" pour recevoir un mot de passe à usage unique (OTP) sur votre téléphone.</li>
                                <li>Saisissez l'OTP reçu dans le champ prévu à cet effet.</li>
                                <li>Après la vérification réussie de l'OTP, le code PIN de la carte sera envoyé au numéro de téléphone.</li>
                            </ol>
                        </div>

                        <!-- Form Section -->
                        <div class="flex flex-col items-center justify-center w-full sm:w-2/3 sm:order-1">
                            <!-- OTP Verification Form -->
                            <ng-container *ngIf="otpSent && !otpVerified; else cardholderForm">
                                <form [formGroup]="otpFormGroup" (ngSubmit)="verifyOtp()" class="flex flex-col mt-8 p-12 pb-4 bg-white rounded-2xl shadow overflow-hidden w-full max-w-lg">
                                    <div class="flex justify-end mb-4">
                                        <button type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none" (click)="cancelOtp()">
                                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="flex flex-col items-center">
                                        <img src="assets/images/logo/opt.png" class="w-30 h-30 mb-4">
                                        <h2>Verify your Code</h2>
                                        <p>Please enter the 6 digit code sent to {{ phoneNumber }}</p>
                                        <div class="flex space-x-2 mt-4">
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp1" appOtpInput>
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp2" appOtpInput>
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp3" appOtpInput>
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp4" appOtpInput>
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp5" appOtpInput>
                                            <input type="text" maxlength="1" class="w-20 h-20 text-center border border-gray-300 rounded otp-input" formControlName="otp6" appOtpInput>
                                        </div>
                                        <div class="flex justify-center mt-4">
                                            <button type="submit" [disabled]="!otpFormGroup.valid" class="mt-4 px-6 py-3 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                                                Verify OTP
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </ng-container>

                            <!-- Cardholder Form -->
                            <ng-template #cardholderForm>
                                <form [formGroup]="firstFormGroup" (ngSubmit)="sendOtp()" class="flex flex-col mt-8 p-12 pb-4 bg-white rounded-2xl shadow overflow-hidden w-full max-w-lg">
                                    <div class="flex w-full gap-4">
                                        <div class="flex-80">
                                            <mat-form-field class="w-full">
                                                <mat-label>Card Number</mat-label>
                                                <mat-icon matPrefix>credit_card</mat-icon>
                                                <input matInput formControlName="cardNumber" placeholder="Enter your 16-digit card number" class="bigger-input" appCardNumberFormat>
                                                <mat-error *ngIf="firstFormGroup.controls.cardNumber.hasError('required')">Card Number is required</mat-error>
                                                <mat-error *ngIf="firstFormGroup.controls.cardNumber.hasError('pattern')">Card Number must be 16 digits and valid</mat-error>
                                            </mat-form-field>
                                        </div>
                                        <div class="flex-20">
                                            <mat-form-field class="w-full">
                                                <mat-label>Expiration</mat-label>
                                                <input matInput formControlName="cardExpiration" placeholder="MM/YY" class="bigger-input" maxlength="5" (input)="formatExpiration($event)">
                                                <mat-error *ngIf="firstFormGroup.controls.cardExpiration.hasError('required')">Expiration date is required</mat-error>
                                                <mat-error *ngIf="firstFormGroup.controls.cardExpiration.hasError('invalidMonth')">Month must be between 01 and 12</mat-error>
                                                <mat-error *ngIf="firstFormGroup.controls.cardExpiration.hasError('invalidYear')">Year must be valid</mat-error>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <mat-form-field class="w-full">
                                            <mat-label>CIN</mat-label>
                                            <mat-icon matPrefix>badge</mat-icon>
                                            <input matInput formControlName="cin" placeholder="Enter your 8-digit CIN" class="bigger-input" maxlength="8">
                                            <mat-error *ngIf="firstFormGroup.controls.cin.hasError('required')">CIN is required</mat-error>
                                            <mat-error *ngIf="firstFormGroup.controls.cin.hasError('pattern')">CIN must be 8 digits</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="form-group">
                                        <mat-form-field class="w-full">
                                            <mat-label>Phone Number</mat-label>
                                            <mat-icon matPrefix>phone</mat-icon>
                                            <div class="flex">
                                                <span class="inline-flex items-center px-3 text-gray-500 bg-gray-200 border border-r-0 border-gray-300 rounded-l-md">+216</span>
                                                <input matInput formControlName="phoneNumber" placeholder="Enter your 8-digit phone number" class="rounded-r-md bigger-input" maxlength="8">
                                            </div>
                                            <mat-error *ngIf="firstFormGroup.controls.phoneNumber.hasError('required')">Phone Number is required</mat-error>
                                            <mat-error *ngIf="firstFormGroup.controls.phoneNumber.hasError('pattern')">Phone Number must be 8 digits</mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="flex justify-center mt-4">
                                        <button mat-raised-button color="primary" class="w-full smaller-button" type="submit" [disabled]="!firstFormGroup.valid">Send OTP</button>
                                    </div>
                                    
                                </form>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</div>
